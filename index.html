<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aggressive Gem Trader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap');
        body { background: #000; color: #fff; font-family: 'Space Grotesk', sans-serif; overflow-x: hidden; }
        .glow-card { background: rgba(20, 20, 20, 0.9); border: 1px solid rgba(0, 255, 255, 0.1); box-shadow: 0 0 30px rgba(0, 255, 255, 0.05); }
        .input-dark { background: #0a0a0a !important; border: 1px solid #222 !important; color: #00f2ff !important; font-family: monospace; }
        .btn-aggressive { background: linear-gradient(45deg, #00f2ff, #0066ff); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .btn-aggressive:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0, 242, 255, 0.4); }
        .btn-danger { background: linear-gradient(45deg, #ff0055, #ff0000); }
        .log-entry { border-left: 2px solid #333; padding-left: 8px; margin-bottom: 4px; font-size: 10px; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">
    <div class="w-full max-w-lg space-y-4">
        <!-- Network Panel -->
        <div class="flex p-1 bg-zinc-900 rounded-2xl gap-1">
            <button onclick="changeNet('eth')" id="net-eth" class="flex-1 py-2 rounded-xl text-[10px] font-bold transition-all border border-cyan-500 bg-cyan-500/10">ETHEREUM</button>
            <button onclick="changeNet('bsc')" id="net-bsc" class="flex-1 py-2 rounded-xl text-[10px] font-bold transition-all border border-transparent">BSC</button>
            <button onclick="changeNet('base')" id="net-base" class="flex-1 py-2 rounded-xl text-[10px] font-bold transition-all border border-transparent">BASE</button>
        </div>

        <!-- Wallet Interface -->
        <div class="glow-card rounded-[2.5rem] p-8">
            <div class="flex justify-between mb-6">
                <div>
                    <p class="text-[10px] text-zinc-500 tracking-[0.2em] mb-1 uppercase">Bakiye Ana Ağ</p>
                    <h2 class="text-4xl font-bold tracking-tighter"><span id="main-bal">0.00</span> <span class="text-cyan-400 text-lg net-sym">ETH</span></h2>
                </div>
                <div class="h-12 w-12 rounded-full border border-zinc-800 flex items-center justify-center">
                    <div id="conn-status" class="w-2 h-2 rounded-full bg-red-600"></div>
                </div>
            </div>
            <input type="password" id="pk" placeholder="Özel Anahtar (0x...)" class="input-dark w-full px-5 py-4 rounded-2xl text-sm mb-4 outline-none">
            <button onclick="connect()" class="btn-aggressive w-full text-black font-black py-4 rounded-2xl tracking-widest text-xs">CÜZDANI AKTİFLEŞTİR</button>
        </div>

        <!-- Trading Engine -->
        <div id="engine" class="glow-card rounded-[2.5rem] p-8 opacity-20 pointer-events-none transition-all duration-700">
            <div class="space-y-6">
                <div>
                    <label class="text-[10px] text-zinc-500 font-bold mb-3 block tracking-widest">GEM TOKEN KONTRATI</label>
                    <input type="text" id="t-addr" oninput="loadToken()" placeholder="0x..." class="input-dark w-full px-5 py-4 rounded-2xl text-sm">
                    <div class="flex justify-between mt-3 text-[10px] text-zinc-400 px-1">
                        <span id="t-name">Token: ---</span>
                        <span id="t-bal">Senin Bakiyen: 0.00</span>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-zinc-900/50 p-4 rounded-3xl border border-zinc-800">
                        <label class="text-[9px] text-zinc-500 block mb-2 uppercase">İşlem Tutarı</label>
                        <input type="number" id="amt" value="0.01" step="0.01" oninput="updateEst()" class="bg-transparent text-xl font-bold w-full outline-none text-white">
                        <span class="text-[10px] text-zinc-600 net-sym">ETH</span>
                    </div>
                    <div class="bg-zinc-900/50 p-4 rounded-3xl border border-zinc-800">
                        <label class="text-[9px] text-zinc-500 block mb-2 uppercase">Kayma (Slippage)</label>
                        <input type="number" id="slip" value="25" class="bg-transparent text-xl font-bold w-full outline-none text-rose-500">
                        <span class="text-[10px] text-zinc-600">%</span>
                    </div>
                </div>

                <div class="bg-cyan-500/5 border border-cyan-500/10 p-4 rounded-2xl flex justify-between items-center">
                    <span class="text-[10px] text-zinc-400">Tahmini Token Alımı:</span>
                    <span class="text-sm font-bold text-cyan-400" id="est-out">0.00</span>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <button onclick="swap('BUY')" class="btn-aggressive text-black font-black py-5 rounded-3xl text-sm">AGRESİF AL</button>
                    <button onclick="swap('SELL')" class="btn-danger text-white font-black py-5 rounded-3xl text-sm">HIZLI SAT</button>
                </div>
            </div>
        </div>

        <!-- Real-time Console -->
        <div class="bg-black border border-zinc-800 rounded-2xl p-4 overflow-hidden">
            <div id="console" class="h-32 overflow-y-auto font-mono text-zinc-500">
                <div class="log-entry">> Bekleniyor...</div>
            </div>
        </div>
    </div>

    <script>
        const CONFIGS = {
            eth: { rpc: 'https://eth.llamarpc.com', router: '0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D', weth: '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2', sym: 'ETH' },
            bsc: { rpc: 'https://binance.llamarpc.com', router: '0x10ED43C718714eb63d5aA57B78B54704E256024E', weth: '0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c', sym: 'BNB' },
            base: { rpc: 'https://base.llamarpc.com', router: '0x4752ba5DBc23f44D82143D093042C17693184712', weth: '0x4200000000000000000000000000000000000006', sym: 'ETH' }
        };

        let activeNet = 'eth';
        let wallet, provider, router, tokenObj;
        let decimals = 18;

        const log = (m, color = '') => {
            const c = document.getElementById('console');
            const d = document.createElement('div');
            d.className = `log-entry ${color}`;
            d.innerText = `[${new Date().toLocaleTimeString()}] ${m}`;
            c.prepend(d);
        };

        function changeNet(id) {
            activeNet = id;
            document.querySelectorAll('[id^="net-"]').forEach(el => el.className = "flex-1 py-2 rounded-xl text-[10px] font-bold transition-all border border-transparent bg-zinc-900");
            document.getElementById(`net-${id}`).className = "flex-1 py-2 rounded-xl text-[10px] font-bold transition-all border border-cyan-500 bg-cyan-500/10";
            document.querySelectorAll('.net-sym').forEach(el => el.innerText = CONFIGS[id].sym);
            log(`${CONFIGS[id].sym} ağına geçildi.`);
            if(wallet) connect();
        }

        async function connect() {
            const key = document.getElementById('pk').value;
            if(!key) return log("Lütfen anahtarı girin!", "text-rose-500");
            try {
                provider = new ethers.providers.JsonRpcProvider(CONFIGS[activeNet].rpc);
                wallet = new ethers.Wallet(key, provider);
                router = new ethers.Contract(CONFIGS[activeNet].router, [
                    "function getAmountsOut(uint amountIn, address[] calldata path) external view returns (uint[] memory amounts)",
                    "function swapExactETHForTokensSupportingFeeOnTransferTokens(uint amountOutMin, address[] calldata path, address to, uint deadline) external payable",
                    "function swapExactTokensForETHSupportingFeeOnTransferTokens(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline) external"
                ], wallet);
                const b = await provider.getBalance(wallet.address);
                document.getElementById('main-bal').innerText = parseFloat(ethers.utils.formatEther(b)).toFixed(4);
                document.getElementById('conn-status').className = "w-2 h-2 rounded-full bg-cyan-400 shadow-[0_0_10px_#00f2ff]";
                document.getElementById('engine').style.opacity = "1";
                document.getElementById('engine').style.pointerEvents = "auto";
                log("Cüzdan bağlandı.");
                if(document.getElementById('t-addr').value) loadToken();
            } catch (e) { log("Bağlantı hatası!", "text-rose-500"); }
        }

        async function loadToken() {
            const addr = document.getElementById('t-addr').value;
            if(!ethers.utils.isAddress(addr)) return;
            try {
                tokenObj = new ethers.Contract(addr, [
                    "function symbol() view returns (string)",
                    "function decimals() view returns (uint8)",
                    "function balanceOf(address) view returns (uint256)",
                    "function approve(address, uint256) returns (bool)",
                    "function allowance(address, address) view returns (uint256)"
                ], wallet);
                const [sym, dec, bal] = await Promise.all([tokenObj.symbol(), tokenObj.decimals(), tokenObj.balanceOf(wallet.address)]);
                decimals = dec;
                document.getElementById('t-name').innerText = `Token: ${sym}`;
                document.getElementById('t-bal').innerText = `Senin Bakiyen: ${parseFloat(ethers.utils.formatUnits(bal, dec)).toFixed(2)}`;
                updateEst();
                log(`${sym} başarıyla yüklendi.`);
            } catch (e) { document.getElementById('t-name').innerText = "Kontrat Geçersiz!"; }
        }

        async function updateEst() {
            const addr = document.getElementById('t-addr').value;
            if(!ethers.utils.isAddress(addr) || !router) return;
            try {
                const amountIn = ethers.utils.parseEther(document.getElementById('amt').value || "0");
                const path = [CONFIGS[activeNet].weth, addr];
                const amounts = await router.getAmountsOut(amountIn, path);
                document.getElementById('est-out').innerText = parseFloat(ethers.utils.formatUnits(amounts[1], decimals)).toFixed(4);
            } catch (e) {}
        }

        async function swap(mode) {
            const addr = document.getElementById('t-addr').value;
            const slippage = document.getElementById('slip').value;
            const deadline = Math.floor(Date.now() / 1000) + 1200; // 20 dk tolerans

            try {
                const path = mode === 'BUY' ? [CONFIGS[activeNet].weth, addr] : [addr, CONFIGS[activeNet].weth];
                const amountIn = mode === 'BUY' ? ethers.utils.parseEther(document.getElementById('amt').value) : await tokenObj.balanceOf(wallet.address);
                
                if(amountIn.isZero()) throw new Error("Miktar sıfır olamaz!");

                const amounts = await router.getAmountsOut(amountIn, path);
                const minOut = amounts[1].mul(100 - slippage).div(100);

                if(mode === 'SELL') {
                    const allow = await tokenObj.allowance(wallet.address, CONFIGS[activeNet].router);
                    if(allow.lt(amountIn)) {
                        log("Onay (Approve) veriliyor...");
                        const atx = await tokenObj.approve(CONFIGS[activeNet].router, ethers.constants.MaxUint256);
                        await atx.wait();
                        log("Onay alındı.");
                    }
                }

                log(`${mode} işlemi gönderiliyor (Agresif Mod)...`);
                const gp = await provider.getGasPrice();
                const txParams = { gasLimit: 500000, gasPrice: gp.mul(15).div(10) }; // %50 yüksek gaz

                let tx;
                // NOT: FeeOnTransfer sürümü gem coinlerdeki vergileri aşmak için zorunludur.
                if(mode === 'BUY') {
                    tx = await router.swapExactETHForTokensSupportingFeeOnTransferTokens(minOut, path, wallet.address, deadline, { ...txParams, value: amountIn });
                } else {
                    tx = await router.swapExactTokensForETHSupportingFeeOnTransferTokens(amountIn, minOut, path, wallet.address, deadline, txParams);
                }

                log(`Hash: ${tx.hash.slice(0,12)}...`, "text-cyan-400");
                await tx.wait();
                log(`${mode} BAŞARILI!`, "text-emerald-400");
                connect();
            } catch (e) {
                log("Hata: " + (e.reason || "İşlem reddedildi. Slippage artırın veya Honeypot kontrolü yapın."), "text-rose-500");
            }
        }
    </script>
</body>
</html>

