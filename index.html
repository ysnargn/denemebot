<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Chain Gem Trader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        body {
            background-color: #020617;
            color: #f8fafc;
            font-family: 'Inter', sans-serif;
        }
        .network-active {
            border-color: #22d3ee;
            background: rgba(34, 211, 238, 0.1);
        }
    </style>
</head>
<body class="min-h-screen p-4 flex flex-col items-center">
    <div class="w-full max-w-xl">
        <!-- Network Selector -->
        <div class="grid grid-cols-3 gap-2 mb-6">
            <button onclick="switchNetwork('eth')" id="btn-eth" class="network-active glass p-3 rounded-xl flex flex-col items-center transition-all border-2 border-transparent">
                <span class="text-xs font-bold">Ethereum</span>
                <span class="text-[10px] text-slate-500">Mainnet</span>
            </button>
            <button onclick="switchNetwork('bsc')" id="btn-bsc" class="glass p-3 rounded-xl flex flex-col items-center transition-all border-2 border-transparent">
                <span class="text-xs font-bold text-yellow-500">BSC</span>
                <span class="text-[10px] text-slate-500">Smart Chain</span>
            </button>
            <button onclick="switchNetwork('base')" id="btn-base" class="glass p-3 rounded-xl flex flex-col items-center transition-all border-2 border-transparent">
                <span class="text-xs font-bold text-blue-500">Base</span>
                <span class="text-[10px] text-slate-500">L2</span>
            </button>
        </div>

        <!-- Wallet Info Card -->
        <div class="glass rounded-3xl p-6 mb-6 relative overflow-hidden">
            <div class="absolute top-0 right-0 p-4">
                <div id="status-dot" class="w-3 h-3 rounded-full bg-red-500 shadow-[0_0_10px_#ef4444]"></div>
            </div>
            
            <h2 class="text-slate-400 text-sm font-medium mb-1">Cüzdan Bakiyesi</h2>
            <div class="flex items-baseline gap-2 mb-4">
                <span id="native-balance" class="text-3xl font-bold tracking-tight">0.00</span>
                <span id="native-symbol" class="text-slate-500 font-medium">ETH</span>
            </div>

            <div class="space-y-3">
                <input type="password" id="privateKey" placeholder="Private Key (0x...)" class="w-full bg-black/40 border border-slate-700 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-cyan-500 transition-all">
                <button onclick="connectWallet()" id="connectBtn" class="w-full bg-white text-black font-bold py-3 rounded-xl hover:bg-slate-200 transition-all">
                    Cüzdanı Bağla
                </button>
            </div>
            
            <div id="wallet-address" class="mt-4 text-[10px] font-mono text-slate-500 break-all text-center"></div>
        </div>

        <!-- Trading Terminal -->
        <div id="tradePanel" class="glass rounded-3xl p-6 opacity-40 pointer-events-none transition-all">
            <div class="flex items-center justify-between mb-6">
                <h3 class="font-bold flex items-center gap-2">
                    <div class="w-2 h-5 bg-cyan-500 rounded-full"></div>
                    İşlem Terminali
                </h3>
                <div id="token-balance-display" class="text-xs text-cyan-400 font-mono">Token: 0.00</div>
            </div>

            <div class="space-y-5">
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Hedef Token Kontratı</label>
                    <input type="text" id="tokenAddress" onchange="updateTokenInfo()" placeholder="0x..." class="w-full bg-black/40 border border-slate-700 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-cyan-500">
                    <div id="tokenName" class="mt-2 text-xs text-slate-400 italic px-1 h-4"></div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Miktar (<span class="sym-display">ETH</span>)</label>
                        <input type="number" id="buyAmount" value="0.01" step="0.01" class="w-full bg-black/40 border border-slate-700 rounded-xl px-4 py-3 text-sm focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Slippage (%)</label>
                        <input type="number" id="slippage" value="10" class="w-full bg-black/40 border border-slate-700 rounded-xl px-4 py-3 text-sm focus:outline-none">
                    </div>
                </div>

                <div class="flex gap-3 pt-2">
                    <button onclick="executeTrade('BUY')" class="flex-1 bg-emerald-500 hover:bg-emerald-400 text-white font-bold py-4 rounded-2xl transition-all active:scale-95">
                        ALIM YAP
                    </button>
                    <button onclick="executeTrade('SELL')" class="flex-1 bg-rose-500 hover:bg-rose-400 text-white font-bold py-4 rounded-2xl transition-all active:scale-95">
                        SATIŞ YAP
                    </button>
                </div>
            </div>
        </div>

        <!-- Terminal Logs -->
        <div class="mt-6 glass rounded-2xl p-4">
            <div id="logs" class="h-32 overflow-y-auto font-mono text-[10px] space-y-1 text-slate-400">
                <div>> Sistem hazır. Lütfen ağ seçin ve cüzdan bağlayın.</div>
            </div>
        </div>
    </div>

    <script>
        const NETWORKS = {
            eth: {
                name: 'Ethereum',
                rpc: 'https://eth.llamarpc.com',
                router: '0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D',
                weth: '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2',
                symbol: 'ETH'
            },
            bsc: {
                name: 'BSC',
                rpc: 'https://binance.llamarpc.com',
                router: '0x10ED43C718714eb63d5aA57B78B54704E256024E',
                weth: '0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c',
                symbol: 'BNB'
            },
            base: {
                name: 'Base',
                rpc: 'https://base.llamarpc.com',
                router: '0x4752ba5DBc23f44D82143D093042C17693184712', // Base V2 Router
                weth: '0x4200000000000000000000000000000000000006',
                symbol: 'ETH'
            }
        };

        let currentNet = 'eth';
        let wallet, provider, router;

        const ROUTER_ABI = [
            "function swapExactETHForTokens(uint amountOutMin, address[] calldata path, address to, uint deadline) external payable returns (uint[] memory amounts)",
            "function swapExactTokensForETH(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline) external returns (uint[] memory amounts)",
            "function getAmountsOut(uint amountIn, address[] calldata path) external view returns (uint[] memory amounts)"
        ];

        const ERC20_ABI = [
            "function name() view returns (string)",
            "function symbol() view returns (string)",
            "function balanceOf(address) view returns (uint256)",
            "function approve(address, uint256) returns (bool)",
            "function decimals() view returns (uint8)"
        ];

        function log(msg, error = false) {
            const logs = document.getElementById('logs');
            const div = document.createElement('div');
            div.className = error ? 'text-rose-400' : 'text-slate-400';
            div.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logs.prepend(div);
        }

        function switchNetwork(id) {
            currentNet = id;
            document.querySelectorAll('[id^="btn-"]').forEach(b => b.classList.remove('network-active'));
            document.getElementById(`btn-${id}`).classList.add('network-active');
            document.querySelectorAll('.sym-display').forEach(el => el.innerText = NETWORKS[id].symbol);
            document.getElementById('native-symbol').innerText = NETWORKS[id].symbol;
            log(`${NETWORKS[id].name} ağına geçildi.`);
            if(wallet) connectWallet(); // Cüzdan bağlıysa yeniden başlat
        }

        async function connectWallet() {
            const key = document.getElementById('privateKey').value;
            if(!key) return log("Private Key girilmedi!", true);

            try {
                provider = new ethers.providers.JsonRpcProvider(NETWORKS[currentNet].rpc);
                wallet = new ethers.Wallet(key, provider);
                router = new ethers.Contract(NETWORKS[currentNet].router, ROUTER_ABI, wallet);
                
                // Bakiyeyi Getir
                const bal = await provider.getBalance(wallet.address);
                document.getElementById('native-balance').innerText = parseFloat(ethers.utils.formatEther(bal)).toFixed(4);
                document.getElementById('wallet-address').innerText = wallet.address;
                document.getElementById('status-dot').className = "w-3 h-3 rounded-full bg-emerald-500 shadow-[0_0_10px_#10b981]";
                
                document.getElementById('tradePanel').style.opacity = "1";
                document.getElementById('tradePanel').style.pointerEvents = "auto";
                
                log("Cüzdan bağlandı. Bakiye güncellendi.");
                updateTokenInfo(); // Varsa token bilgisini de tazele
            } catch (e) {
                log("Bağlantı Hatası: " + e.message, true);
            }
        }

        async function updateTokenInfo() {
            const addr = document.getElementById('tokenAddress').value;
            if(!ethers.utils.isAddress(addr) || !wallet) return;

            try {
                const token = new ethers.Contract(addr, ERC20_ABI, provider);
                const [name, symbol, balance, decimals] = await Promise.all([
                    token.name(),
                    token.symbol(),
                    token.balanceOf(wallet.address),
                    token.decimals()
                ]);
                
                document.getElementById('tokenName').innerText = `${name} (${symbol})`;
                document.getElementById('token-balance-display').innerText = `${symbol}: ${parseFloat(ethers.utils.formatUnits(balance, decimals)).toFixed(2)}`;
                log(`${symbol} verileri çekildi.`);
            } catch (e) {
                document.getElementById('tokenName').innerText = "Geçersiz token!";
            }
        }

        async function executeTrade(mode) {
            const tokenAddr = document.getElementById('tokenAddress').value;
            const slippage = document.getElementById('slippage').value;
            const deadline = Math.floor(Date.now() / 1000) + 300; // 5 dk

            try {
                const path = mode === 'BUY' ? [NETWORKS[currentNet].weth, tokenAddr] : [tokenAddr, NETWORKS[currentNet].weth];
                
                if(mode === 'BUY') {
                    const amountIn = ethers.utils.parseEther(document.getElementById('buyAmount').value);
                    log("Fiyat hesaplanıyor...");
                    const amounts = await router.getAmountsOut(amountIn, path);
                    const amountOutMin = amounts[1].mul(100 - slippage).div(100);

                    log("Alım gönderiliyor...");
                    const tx = await router.swapExactETHForTokens(
                        amountOutMin, path, wallet.address, deadline,
                        { value: amountIn, gasLimit: 300000 }
                    );
                    log(`TX: ${tx.hash.substring(0,20)}...`);
                    await tx.wait();
                    log("ALIM BAŞARILI!", false);
                } else {
                    const token = new ethers.Contract(tokenAddr, ERC20_ABI, wallet);
                    const balance = await token.balanceOf(wallet.address);
                    
                    log("Onay veriliyor (Approve)...");
                    const appTx = await token.approve(NETWORKS[currentNet].router, balance);
                    await appTx.wait();

                    log("Fiyat hesaplanıyor...");
                    const amounts = await router.getAmountsOut(balance, path);
                    const amountOutMin = amounts[1].mul(100 - slippage).div(100);

                    log("Satış gönderiliyor...");
                    const tx = await router.swapExactTokensForETH(
                        balance, amountOutMin, path, wallet.address, deadline,
                        { gasLimit: 300000 }
                    );
                    log(`TX: ${tx.hash.substring(0,20)}...`);
                    await tx.wait();
                    log("SATIŞ BAŞARILI!", false);
                }
                connectWallet(); // Bakiyeleri tazele
            } catch (e) {
                log("HATA: " + (e.reason || "İşlem reddedildi"), true);
            }
        }
    </script>
</body>
</html>

