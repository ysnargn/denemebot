<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gem Hunter Pro Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        body { background-color: #050505; color: #e2e8f0; font-family: 'JetBrains+Mono', monospace; }
        .glass { background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .neon-border { border: 1px solid rgba(34, 211, 238, 0.3); box-shadow: 0 0 15px rgba(34, 211, 238, 0.1); }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="min-h-screen p-4 flex flex-col items-center">
    <div class="w-full max-w-lg">
        <!-- Network Switcher -->
        <div class="flex gap-2 mb-4 bg-white/5 p-1 rounded-2xl">
            <button onclick="switchNetwork('eth')" id="btn-eth" class="flex-1 py-2 rounded-xl text-xs font-bold transition-all border border-transparent">ETH</button>
            <button onclick="switchNetwork('bsc')" id="btn-bsc" class="flex-1 py-2 rounded-xl text-xs font-bold transition-all border border-transparent">BSC</button>
            <button onclick="switchNetwork('base')" id="btn-base" class="flex-1 py-2 rounded-xl text-xs font-bold transition-all border border-transparent">BASE</button>
        </div>

        <!-- Wallet Card -->
        <div class="glass rounded-3xl p-6 mb-4 neon-border">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <p class="text-[10px] text-slate-500 uppercase tracking-widest">Cüzdan Bakiyesi</p>
                    <h2 class="text-3xl font-bold"><span id="native-balance">0.00</span> <span class="text-cyan-500 sym-display text-xl">ETH</span></h2>
                </div>
                <div id="status-indicator" class="w-2 h-2 rounded-full bg-red-500"></div>
            </div>
            
            <input type="password" id="privateKey" placeholder="Özel Anahtar (0x...)" class="w-full bg-black border border-white/10 rounded-xl px-4 py-3 text-sm mb-3 focus:border-cyan-500 outline-none">
            <button onclick="connectWallet()" id="connectBtn" class="w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 rounded-xl transition-all">CÜZDANI BAĞLA</button>
        </div>

        <!-- Trading Interface -->
        <div id="tradePanel" class="glass rounded-3xl p-6 opacity-30 pointer-events-none transition-all">
            <div class="mb-6">
                <label class="text-[10px] text-slate-500 uppercase block mb-2">Token Kontrat Adresi</label>
                <input type="text" id="tokenAddress" oninput="onTokenAddressChange()" placeholder="0x..." class="w-full bg-black border border-white/10 rounded-xl px-4 py-3 text-sm focus:border-emerald-500 outline-none">
            </div>

            <!-- Interaction Area -->
            <div class="space-y-4">
                <!-- Buy Box -->
                <div class="bg-white/5 p-4 rounded-2xl border border-white/5">
                    <div class="flex justify-between text-[10px] mb-2">
                        <span class="text-slate-400">ALIM MİKTARI</span>
                        <span class="text-cyan-400">Tahmini Alınacak: <span id="est-buy-tokens">0</span> <span class="token-sym">TOK</span></span>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="number" id="buyAmount" value="0.01" oninput="calculateEstimate('BUY')" class="bg-transparent text-xl font-bold w-full outline-none">
                        <span class="sym-display font-bold text-slate-500">ETH</span>
                    </div>
                </div>

                <!-- Sell Box -->
                <div class="bg-white/5 p-4 rounded-2xl border border-white/5">
                    <div class="flex justify-between text-[10px] mb-2">
                        <span class="text-slate-400">SATIŞ MİKTARI</span>
                        <span class="text-emerald-400">Alınacak: <span id="est-sell-native">0</span> <span class="sym-display">ETH</span></span>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="number" id="sellAmount" placeholder="0.0" oninput="calculateEstimate('SELL')" class="bg-transparent text-xl font-bold w-full outline-none">
                        <button onclick="setMaxSell()" class="text-[10px] bg-white/10 px-2 py-1 rounded hover:bg-white/20">MAX</button>
                        <span class="token-sym font-bold text-slate-500">TOKEN</span>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3 mt-4">
                    <button onclick="executeAction('BUY')" class="bg-emerald-500 hover:bg-emerald-400 py-4 rounded-2xl font-bold text-black transition-all">ALIM YAP</button>
                    <button onclick="executeAction('SELL')" class="bg-rose-500 hover:bg-rose-400 py-4 rounded-2xl font-bold text-black transition-all">SATIŞ YAP</button>
                </div>
            </div>
        </div>

        <!-- Terminal Output -->
        <div class="mt-4 bg-black border border-white/5 rounded-2xl p-4 h-40 overflow-y-auto text-[10px] font-mono" id="terminal">
            <div class="text-slate-500">> Terminal hazır. İşlem bekleniyor...</div>
        </div>
    </div>

    <script>
        const CONFIG = {
            eth: { rpc: 'https://eth.llamarpc.com', router: '0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D', weth: '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2', sym: 'ETH' },
            bsc: { rpc: 'https://binance.llamarpc.com', router: '0x10ED43C718714eb63d5aA57B78B54704E256024E', weth: '0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c', sym: 'BNB' },
            base: { rpc: 'https://base.llamarpc.com', router: '0x4752ba5DBc23f44D82143D093042C17693184712', weth: '0x4200000000000000000000000000000000000006', sym: 'ETH' }
        };

        let currentId = 'eth';
        let wallet, provider, router, currentToken;
        let tokenDecimals = 18;

        const ABI = {
            router: ["function getAmountsOut(uint amountIn, address[] calldata path) external view returns (uint[] memory amounts)", "function swapExactETHForTokens(uint amountOutMin, address[] calldata path, address to, uint deadline) external payable returns (uint[] memory amounts)", "function swapExactTokensForETH(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline) external returns (uint[] memory amounts)"],
            erc20: ["function name() view returns (string)", "function symbol() view returns (string)", "function decimals() view returns (uint8)", "function balanceOf(address) view returns (uint256)", "function approve(address, uint256) returns (bool)"]
        };

        function writeTerminal(msg, color = 'text-slate-400') {
            const t = document.getElementById('terminal');
            const d = document.createElement('div');
            d.className = color;
            d.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
            t.prepend(d);
        }

        function switchNetwork(id) {
            currentId = id;
            document.querySelectorAll('[id^="btn-"]').forEach(b => b.className = "flex-1 py-2 rounded-xl text-xs font-bold transition-all border border-transparent bg-white/5");
            document.getElementById(`btn-${id}`).className = "flex-1 py-2 rounded-xl text-xs font-bold transition-all border border-cyan-500/50 bg-cyan-500/10";
            document.querySelectorAll('.sym-display').forEach(el => el.innerText = CONFIG[id].sym);
            writeTerminal(`${CONFIG[id].sym} ağı seçildi.`);
            if(wallet) connectWallet();
        }

        async function connectWallet() {
            const key = document.getElementById('privateKey').value;
            if(!key) return;
            try {
                provider = new ethers.providers.JsonRpcProvider(CONFIG[currentId].rpc);
                wallet = new ethers.Wallet(key, provider);
                router = new ethers.Contract(CONFIG[currentId].router, ABI.router, wallet);
                const b = await provider.getBalance(wallet.address);
                document.getElementById('native-balance').innerText = parseFloat(ethers.utils.formatEther(b)).toFixed(4);
                document.getElementById('status-indicator').className = "w-2 h-2 rounded-full bg-emerald-500";
                document.getElementById('tradePanel').style.opacity = "1";
                document.getElementById('tradePanel').style.pointerEvents = "auto";
                writeTerminal("Cüzdan bağlandı: " + wallet.address.slice(0,6) + "...");
            } catch (e) { writeTerminal("Cüzdan hatası!", "text-rose-500"); }
        }

        async function onTokenAddressChange() {
            const addr = document.getElementById('tokenAddress').value;
            if(!ethers.utils.isAddress(addr)) return;
            try {
                currentToken = new ethers.Contract(addr, ABI.erc20, wallet);
                const [sym, dec] = await Promise.all([currentToken.symbol(), currentToken.decimals()]);
                tokenDecimals = dec;
                document.querySelectorAll('.token-sym').forEach(el => el.innerText = sym);
                writeTerminal(`Token aktif: ${sym}`);
                calculateEstimate('BUY');
            } catch (e) { writeTerminal("Token bulunamadı!", "text-rose-500"); }
        }

        async function calculateEstimate(mode) {
            const addr = document.getElementById('tokenAddress').value;
            if(!ethers.utils.isAddress(addr) || !router) return;

            try {
                if(mode === 'BUY') {
                    const val = document.getElementById('buyAmount').value;
                    if(!val || val <= 0) return;
                    const amountIn = ethers.utils.parseEther(val);
                    const path = [CONFIG[currentId].weth, addr];
                    const amounts = await router.getAmountsOut(amountIn, path);
                    document.getElementById('est-buy-tokens').innerText = ethers.utils.formatUnits(amounts[1], tokenDecimals);
                } else {
                    const val = document.getElementById('sellAmount').value;
                    if(!val || val <= 0) return;
                    const amountIn = ethers.utils.parseUnits(val, tokenDecimals);
                    const path = [addr, CONFIG[currentId].weth];
                    const amounts = await router.getAmountsOut(amountIn, path);
                    document.getElementById('est-sell-native').innerText = ethers.utils.formatEther(amounts[1]);
                }
            } catch (e) { console.log(e); }
        }

        async function setMaxSell() {
            if(!currentToken) return;
            const b = await currentToken.balanceOf(wallet.address);
            document.getElementById('sellAmount').value = ethers.utils.formatUnits(b, tokenDecimals);
            calculateEstimate('SELL');
        }

        async function executeAction(mode) {
            const addr = document.getElementById('tokenAddress').value;
            const deadline = Math.floor(Date.now() / 1000) + 600;

            try {
                if(mode === 'BUY') {
                    const val = document.getElementById('buyAmount').value;
                    const amountIn = ethers.utils.parseEther(val);
                    const path = [CONFIG[currentId].weth, addr];
                    const amounts = await router.getAmountsOut(amountIn, path);
                    const minOut = amounts[1].mul(90).div(100); // %10 slippage default

                    writeTerminal("Alım emri gönderiliyor...");
                    const tx = await router.swapExactETHForTokens(minOut, path, wallet.address, deadline, { value: amountIn, gasLimit: 300000 });
                    writeTerminal("TX: " + tx.hash.slice(0,15) + "...");
                    await tx.wait();
                    writeTerminal("ALIM TAMAMLANDI!", "text-emerald-400");
                } else {
                    const val = document.getElementById('sellAmount').value;
                    const amountIn = ethers.utils.parseUnits(val, tokenDecimals);
                    
                    writeTerminal("Token onayı (Approve) veriliyor...");
                    const appTx = await currentToken.approve(CONFIG[currentId].router, amountIn);
                    await appTx.wait();

                    const path = [addr, CONFIG[currentId].weth];
                    const amounts = await router.getAmountsOut(amountIn, path);
                    const minOut = amounts[1].mul(90).div(100);

                    writeTerminal("Satış emri gönderiliyor...");
                    const tx = await router.swapExactTokensForETH(amountIn, minOut, path, wallet.address, deadline, { gasLimit: 300000 });
                    writeTerminal("TX: " + tx.hash.slice(0,15) + "...");
                    await tx.wait();
                    writeTerminal("SATIŞ TAMAMLANDI!", "text-emerald-400");
                }
                connectWallet();
            } catch (e) { writeTerminal("Hata: " + (e.reason || "İşlem başarısız"), "text-rose-500"); }
        }

        // Init
        switchNetwork('eth');
    </script>
</body>
</html>

